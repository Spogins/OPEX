/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 6.0.0 (TBD)
 */
!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager");const e=t=>e=>typeof e===t,o=("string",t=>"string"===(t=>{const e=typeof t;return null===t?"null":"object"===e&&Array.isArray(t)?"array":"object"===e&&(o=n=t,(r=String).prototype.isPrototypeOf(o)||(null===(i=n.constructor)||void 0===i?void 0:i.name)===r.name)?"string":e;var o,n,r,i})(t));const n=e("boolean"),r=e("function"),i=t=>e=>e.options.get(t),s=i("quickbars_selection_toolbar"),a=i("quickbars_insert_toolbar"),l=i("quickbars_image_toolbar");let c=0;var u=tinymce.util.Tools.resolve("tinymce.Env"),d=tinymce.util.Tools.resolve("tinymce.util.Delay");const m=t=>{t.ui.registry.addButton("quickimage",{icon:"image",tooltip:"Insert image",onAction:()=>{(t=>new Promise((e=>{const o=document.createElement("input");o.type="file",o.accept="image/*",o.style.position="fixed",o.style.left="0",o.style.top="0",o.style.opacity="0.001",document.body.appendChild(o),o.addEventListener("change",(t=>{e(Array.prototype.slice.call(t.target.files))}));const n=r=>{const i=()=>{e([]),o.parentNode.removeChild(o)};u.os.isAndroid()&&"remove"!==r.type?d.setEditorTimeout(t,i,0):i(),t.off("focusin remove",n)};t.on("focusin remove",n),o.click()})))(t).then((e=>{if(e.length>0){const o=e[0];(t=>new Promise((e=>{const o=new FileReader;o.onloadend=()=>{e(o.result.split(",")[1])},o.readAsDataURL(t)})))(o).then((e=>{((t,e,o)=>{const n=t.editorUpload.blobCache,r=n.create((t=>{const e=(new Date).getTime(),o=Math.floor(1e9*Math.random());return c++,"mceu_"+o+c+String(e)})(),o,e);n.add(r),t.insertContent(t.dom.createHTML("img",{src:r.blobUri()}))})(t,e,o)}))}}))}}),t.ui.registry.addButton("quicktable",{icon:"table",tooltip:"Insert table",onAction:()=>{((t,e,o)=>{t.plugins.table?t.plugins.table.insertTable(2,2):((t,e,o)=>{t.undoManager.transact((()=>{t.insertContent(((t,e)=>{let o='<table data-mce-id="mce" style="width: 100%">';o+="<tbody>";for(let t=0;t<2;t++){o+="<tr>";for(let t=0;t<2;t++)o+="<td><br></td>";o+="</tr>"}return o+="</tbody>",o+="</table>",o})());const e=(t=>t.dom.select("*[data-mce-id]")[0])(t);e.removeAttribute("data-mce-id");const o=t.dom.select("td,th",e);t.selection.setCursorLocation(o[0],0)}))})(t)})(t)}})},g=(!1,()=>false);class h{constructor(t,e){this.tag=t,this.value=e}static some(t){return new h(!0,t)}static none(){return h.singletonNone}fold(t,e){return this.tag?e(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?h.some(t(this.value)):h.none()}bind(t){return this.tag?t(this.value):h.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:h.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw new Error(null!=t?t:"Called getOrDie on None")}static from(t){return null==t?h.none():h.some(t)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}h.singletonNone=new h(!1);var b=(t,e,o,n,i)=>t(o,n)?h.some(o):r(i)&&i(o)?h.none():e(o,n,i);const p=t=>{if(null==t)throw new Error("Node cannot be null or undefined");return{dom:t}},f=p,v=(t,e)=>{const o=t.dom;if(1!==o.nodeType)return!1;{const t=o;if(void 0!==t.matches)return t.matches(e);if(void 0!==t.msMatchesSelector)return t.msMatchesSelector(e);if(void 0!==t.webkitMatchesSelector)return t.webkitMatchesSelector(e);if(void 0!==t.mozMatchesSelector)return t.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")}};"undefined"!=typeof window?window:Function("return this;")();const y=(t,e,o)=>{let n=t.dom;const i=r(o)?o:g;for(;n.parentNode;){n=n.parentNode;const t=f(n);if(e(t))return h.some(t);if(i(t))break}return h.none()},k=(t,e,o)=>y(t,(t=>v(t,e)),o),w=t=>{const e=a(t);e.length>0&&t.ui.registry.addContextToolbar("quickblock",{predicate:e=>{const o=f(e),n=t.schema.getTextBlockElements(),r=e=>e.dom===t.getBody();return((t,e,o)=>b(((t,e)=>v(t,e)),k,t,"table",o))(o,0,r).fold((()=>((e,o,r)=>b(((t,e)=>e(t)),y,e,(e=>e.dom.nodeName.toLowerCase()in n&&t.dom.isEmpty(e.dom)),r))(o,0,r).isSome()),g)},items:e,position:"line",scope:"editor"})};t.add("quickbars",(t=>{(t=>{const e=t.options.register,r=t=>e=>{const r=n(e)||o(e);return r?n(e)?{value:e?t:"",valid:r}:{value:e.trim(),valid:r}:{valid:!1,message:"Must be a boolean or string."}},i="bold italic | quicklink h2 h3 blockquote";e("quickbars_selection_toolbar",{processor:r(i),default:i});const s="quickimage quicktable";e("quickbars_insert_toolbar",{processor:r(s),default:s});const a="alignleft aligncenter alignright";e("quickbars_image_toolbar",{processor:r(a),default:a})})(t),m(t),w(t),(t=>{const e=t=>"IMG"===t.nodeName||"FIGURE"===t.nodeName&&/image/i.test(t.className),o=l(t);o.length>0&&t.ui.registry.addContextToolbar("imageselection",{predicate:e,items:o,position:"node"});const n=s(t);n.length>0&&t.ui.registry.addContextToolbar("textselection",{predicate:o=>!e(o)&&!t.selection.isCollapsed()&&(e=>"false"!==t.dom.getContentEditableParent(e))(o),items:n,position:"selection",scope:"editor"})})(t)}))}();
